# CRM 客户关系管理系统 - 需求设计文档
技术栈：  
    前端:
  - React + TypeScript - 适合复杂表格、筛选、分页等交互
  - Ant Design - 提供丰富的表格、表单、日历组件
  - React Query/SWR - 数据管理和缓存

  后端:
  - Node.js + nextjs
  - sqllite - 关系型数据，适合客户-带看记录等关联数据
## 1. 项目概述

本项目旨在开发一个客户关系管理（CRM）系统，以提高房产中介业务的客户跟进效率和成交率。系统核心功能包括客户管理和预约带看管理。通过精细化的客户信息记录、状态追踪和便捷的带看流程，帮助业务人员更好地服务客户，提升业绩。

## 2. 功能需求

系统主要包含两大功能模块：**客户管理**和**预约带看**。

### 2.1. 客户管理模块

本模块是系统的核心，用于统一管理所有客户信息、跟进记录和带看历史。

#### 2.1.1. 客户管理界面

界面UI需参考 `客户管理界面.png` 进行设计。

**a. 数据展示/表格列：**

| 列名 | 数据类型/格式 | 备注 |
| :--- | :--- | :--- |
| **租客姓名** | 文本 | |
| **手机号** | 数字 | 主手机号 |
| **备用手机** | 数字 | 可选 |
| **微信** | 文本 | |
| **状态** | 枚举 | `跟进中`, `客户不再回复`, `已约带看`, `已成交未结佣`, `已成交已结佣` |
| **咨询小区** | 文本 | |
| **需求房型** | 文本 | 由 `业务类型` + `居室` + `标签` 拼接而成 ，在客户信息的数据结构中，拆分为 业务类型、居室、房型标签 三个独立字段，但界面上仍合并显示。
| **入住时间** | 日期/文本 | 主：具体日期；副：租赁周期 |
| **可接受的价格**| 文本 | 例如 "5000-7000" 最多9位整数，2位小数”的数字区间
| **线索佣金** | 数字 | 该客户所有带看记录的佣金总和 |
| **带看次数** | 数字 | 点击可弹出该客户的**带看记录**详情弹窗 |
| **来源渠道** | 枚举 | `闲鱼`, `小红书`, `贝壳`, `58同城`, `视频号`, `抖音`, `转介绍` |
| **录入** | 文本 | 格式："[人工/agent] 托管账号" |
| **操作** | 按钮组 | `查看`, `编辑`, `添加带看` |

**b. 核心功能：**

*   **筛选与搜索**：
    *   提供多个筛选条件（如状态、来源渠道、价格区间等），UI参考 `客户管理-筛选.png`。
    *   当筛选条件变化时，表格数据、下方的统计信息（如客户总数）以及分页必须实时联动更新。
*   **统计功能**：
    *   表格下方需要有关键数据的统计，例如当前筛选条件下的客户总数。
*   **分页**：
    *   支持标准的分页功能。
*   **操作按钮**：
    *   **查看**: 点击后跳转或弹窗显示完整的客户详情，UI参考 `客户管理-用户信息查看.png`。
    *   **编辑**: 点击后允许在当前行或弹窗内对客户信息进行修改。
    *   **添加带看**: 点击后跳转至该客户的**带看记录**添加界面。

#### 2.1.2. 客户详情与带看记录

**a. 客户详情**

*   集中展示该客户的所有信息，包括基本资料和所有历史带看记录。

**b. 带看记录**

*   **交互方式**：
    *   带看记录以列表或表格形式展示。
    *   支持**点击表项直接进行编辑**，无需跳转新页面。
    *   支持**添加**新的带看记录。
    *   为保证数据完整性，**不支持删除**带看记录。
*   **数据字段**：

| 字段名 | 数据类型 | 可选值/枚举 |
| :--- | :--- | :--- |
| **业务类型** | 枚举 | `整租`, `集中`, `合租` |
| **房型** | 枚举 | `一居室`, `两居室`, `三居室`, `四居及以上`, `主卧`, `次卧` |
| **房型标签** | 枚举 | `开间`, `loft`, `平层`, `两卫`, `平房` |
| **带看人** | 文本 | |
| **带看人类型**| 枚举 | `内部管家`, `外部管家`, `外销管家`, `录入人` |
| **带看状态** | 枚举 | `待确认`, `已确认`, `已取消`, `已带看` |
| **带看反馈** | 枚举 | `已成交`, `未成交` |
| **佣金** | 数字 | 本次带看的佣金 |

---

### 2.2. 预约带看模块

本模块用于安排和管理客户的线下看房预约。

#### 2.2.1. 预约带看界面

界面UI需参考 `预约带看界面.png` 进行设计。

**a. 数据展示/表格列：**

| 列名 | 数据类型/格式 | 备注 |
| :--- | :--- | :--- |
| **id** | 主键 | 预约记录唯一标识 |
| **物业名称** | 文本 | 小区/楼盘名称 |
| **房间地址** | 文本 | 具体房源地址 |
| **客户姓名** | 文本 | 关联客户管理模块的客户 |
| **客户电话** | 数字 | 客户联系方式，与客户管理模块保持一致 |
| **经纪人** | 文本 | 负责带看的经纪人 |
| **预约时间** | 日期时间 | 具体的带看时间 |
| **状态** | 枚举 | `待确认`, `已确认`, `进行中`, `已完成`, `已取消` |
| **类型** | 枚举 | `整租`, `合租`, `集中` |
| **创建时间** | 日期时间 | 记录创建时间 |

**b. 核心功能：**

*   **筛选与搜索**：
    *   支持通过城市筛选数据的功能
    *   支持按状态、类型、经纪人等条件筛选
    *   当筛选条件变化时，表格数据实时联动更新
*   **预约管理**：
    *   支持新增、查看和修改预约事件
    *   能清晰地展示每日或每周的带看安排
    *   支持预约状态的流转管理

#### 2.2.2. 数据流转关系

**a. 与客户管理模块的关联：**

*   预约带看通过客户电话字段与客户管理模块关联
*   预约信息能快速定位到相应的客户和房源信息

**b. 数据转化流程：**

*   当预约带看状态变更为"已完成"时，系统自动将该预约转化为客户管理模块中对应客户的一条"带看记录"
*   转化时保持以下数据一致性：
    *   预约带看.客户电话 = 客户管理.手机号
    *   预约带看.经纪人 = 带看记录.带看人  
    *   预约带看.类型 = 带看记录.业务类型
*   转化后自动更新客户状态为"已约带看"
*   两个模块的数据必须保持严格一致性    

## 3. 非功能性需求

*   **性能**：
    *   客户列表的加载、筛选和排序响应应在1秒内完成。
    *   数据统计功能需实时计算，不得出现明显延迟。
*   **易用性**：
    *   界面简洁直观，操作流程符合业务人员的日常习惯。
    *   减少不必要的页面跳转，多使用弹窗和行内编辑等方式提升操作效率。
*   **数据一致性**：
    *   客户的佣金总和、带看次数等统计数据必须与其实际带看记录保持严格一致。
    *   多处展示同一客户信息时（如列表页和详情页），数据需同步更新。
    *   预约带看与客户管理模块的数据转化必须保持一致性。
*   **权限管理**：
    *   当前版本暂不需要权限控制，所有用户均可进行所有操作（增删改查）。
    *   包括：客户信息管理、带看记录管理、预约带看管理等所有功能。
*   **数据流转**：
    *   预约带看状态变更为"已完成"时，必须自动触发数据转化流程。
    *   转化过程中如遇到数据不匹配（如客户电话不存在），需要提供错误处理机制。
    *   转化成功后，需要防止重复转化，避免数据冗余。

## 4. 数据字典

此处定义关键字段的枚举值，供开发时参考。

*   **客户状态 (`status`)**:
    *   `1`: 跟进中
    *   `2`: 客户不再回复
    *   `3`: 已约带看
    *   `4`: 已成交未结佣
    *   `5`: 已成交已结佣
*   **租赁周期 (`lease_period`)**:
    *   `1`: 一个月
    *   `2`: 两个月
    *   `3`: 三个月
    *   `4`: 四个月
    *   `5`: 五个月
    *   `6`: 六个月
    *   `12`: 一年
    *   `24`: 两年
    *   `36`: 三年及以上
*   **带看状态 (`viewing_status`)**:
    *   `1`: 待确认
    *   `2`: 已确认
    *   `3`: 已取消
    *   `4`: 已带看
*   **带看反馈 (`viewing_feedback`)**:
    *   `1`: 已成交
    *   `0`: 未成交
*   **预约带看状态 (`appointment_status`)**:
    *   `1`: 待确认
    *   `2`: 已确认
    *   `3`: 进行中
    *   `4`: 已完成
    *   `5`: 已取消
*   **预约带看类型 (`appointment_type`)**:
    *   `1`: 整租
    *   `2`: 合租
    *   `3`: 集中
