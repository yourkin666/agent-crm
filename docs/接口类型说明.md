# API 接口类型与请求头要求说明

## 📋 接口类型概览

CRM 系统中的接口根据功能分为不同类型，每种类型对请求头的要求也不同。

---

## 🔍 GET 接口（查询类）

### 特点

- **用途**：获取数据，不修改数据
- **参数传递**：通过 URL 查询字符串
- **请求体**：通常不需要
- **请求头**：不需要特殊的 Content-Type

### 示例：外部统计接口

```bash
# 请求
GET /api/external/statistics?userId=123&botId=bot1&date_from=2024-01-01

# 请求头（可选）
Accept: application/json
```

**为什么不需要 JSON 请求头？**

- GET 请求参数通过 URL 传递，不是 JSON 格式
- 服务器返回 JSON 响应，但请求不需要 JSON 格式

---

## 📝 POST 接口（创建类）

### 特点

- **用途**：创建新数据
- **参数传递**：通过请求体（JSON 格式）
- **请求体**：必需，JSON 格式
- **请求头**：需要 `Content-Type: application/json`

### 示例：创建客户接口

```bash
# 请求
POST /api/customers

# 请求头（必需）
Content-Type: application/json

# 请求体
{
  "name": "张三",
  "phone": "13800138000",
  "userId": "123",
  "botId": "bot1"
}
```

---

## 🔄 PUT/PATCH 接口（更新类）

### 特点

- **用途**：更新现有数据
- **参数传递**：通过请求体（JSON 格式）
- **请求体**：必需，JSON 格式
- **请求头**：需要 `Content-Type: application/json`

### 示例：更新客户信息

```bash
# 请求
PUT /api/customers/123

# 请求头（必需）
Content-Type: application/json

# 请求体
{
  "name": "张三（已更新）",
  "status": 4
}
```

---

## 🗑️ DELETE 接口（删除类）

### 特点

- **用途**：删除数据
- **参数传递**：通常通过 URL 路径参数
- **请求体**：通常不需要
- **请求头**：不需要特殊的 Content-Type

### 示例：删除客户

```bash
# 请求
DELETE /api/customers/123

# 请求头（可选）
Accept: application/json
```

---

## 📊 接口类型总结

| 接口类型 | 用途     | 参数传递方式   | 请求体 | Content-Type 要求  |
| -------- | -------- | -------------- | ------ | ------------------ |
| GET      | 查询数据 | URL 查询字符串 | 不需要 | 不需要             |
| POST     | 创建数据 | 请求体（JSON） | 必需   | `application/json` |
| PUT      | 完整更新 | 请求体（JSON） | 必需   | `application/json` |
| PATCH    | 部分更新 | 请求体（JSON） | 必需   | `application/json` |
| DELETE   | 删除数据 | URL 路径参数   | 不需要 | 不需要             |

---

## 🎯 外部统计接口设计说明

### 为什么使用 GET 请求？

1. **符合 RESTful 规范**

   - GET 用于获取数据，不修改数据
   - 统计查询是典型的 GET 操作

2. **便于缓存**

   - GET 请求可以被浏览器和代理服务器缓存
   - 提高性能，减少服务器负载

3. **便于调试**

   - URL 参数直观可见
   - 可以直接在浏览器中测试

4. **支持书签和分享**
   - 完整的查询条件都在 URL 中
   - 可以保存为书签或分享给他人

### 参数传递方式

```bash
# 单参数查询
GET /api/external/statistics?userId=123

# 批量参数查询
GET /api/external/statistics?userId=123,456,789&botId=bot1,bot2

# 组合查询
GET /api/external/statistics?date_from=2024-01-01&date_to=2024-01-31&userId=123&botId=bot1
```

### 响应格式

虽然请求不需要 JSON，但响应始终是 JSON 格式：

```json
{
  "success": true,
  "data": {
    "viewing_count": 150,
    "completed_unpaid_count": 25,
    "completed_paid_count": 10,
    "total_commission": 125000.0,
    "period": {
      "date_from": "2024-01-01",
      "date_to": "2024-01-31"
    },
    "filters": {
      "userIds": ["123", "456"],
      "botIds": ["bot1", "bot2"]
    }
  },
  "message": "统计数据获取成功"
}
```

---

## 🔧 最佳实践建议

### 1. **请求头设置**

```bash
# GET 请求（推荐）
Accept: application/json

# POST/PUT/PATCH 请求（必需）
Content-Type: application/json
Accept: application/json
```

### 2. **错误处理**

所有接口都返回统一的错误格式：

```json
{
  "success": false,
  "error": "错误代码",
  "message": "错误描述"
}
```

### 3. **状态码使用**

- `200`：成功
- `400`：请求参数错误
- `404`：资源不存在
- `500`：服务器内部错误

---

## 📝 总结

外部统计接口使用 GET 请求是合理的设计选择：

- ✅ 符合 RESTful 规范
- ✅ 便于缓存和调试
- ✅ 不需要 JSON 请求头
- ✅ 参数通过 URL 传递，直观易懂
- ✅ 响应仍然是标准的 JSON 格式
