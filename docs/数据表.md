# CRM 系统数据表字段信息

> 文档更新时间：2025-08-06  
> 系统版本：v1.0  
> 包含表：customers（客户表）、viewing_records（带看记录表）

---

## 📊 数据表概览

| 表名            | 字段数量 | 说明         | 主要功能                           |
| --------------- | -------- | ------------ | ---------------------------------- |
| customers       | 24 个    | 客户信息管理 | 客户档案、联系方式、业务需求管理   |
| viewing_records | 34 个    | 带看记录管理 | 带看活动、房源信息、第三方系统集成 |

---

## 🏢 1. customers（客户表）

**表说明**：存储客户的基本信息、联系方式、业务需求和第三方系统关联信息。

### 字段详情（共 24 个字段）

| 序号                        | 字段名             | 数据类型      | 默认值            | 是否必填 | 说明                                                                                   | 状态        |
| --------------------------- | ------------------ | ------------- | ----------------- | -------- | -------------------------------------------------------------------------------------- | ----------- |
| **🏷️ 基础信息字段**         |
| 1                           | `id`               | INTEGER       | -                 | ✅       | 主键，自增 ID                                                                          | 原有        |
| 2                           | `name`             | TEXT          | ''                | ❌       | 租客真实姓名                                                                           | 原有        |
| 3                           | `nickname`         | TEXT          | -                 | ❌       | 客户昵称，便于友好称呼                                                                 | **🆕 新增** |
| 4                           | `phone`            | TEXT          | -                 | ❌       | 主手机号（唯一约束）                                                                   | 原有        |
| 5                           | `backup_phone`     | TEXT          | -                 | ❌       | 备用手机号                                                                             | 原有        |
| 6                           | `wechat`           | TEXT          | -                 | ❌       | 微信号                                                                                 | 原有        |
| **📊 状态和业务信息**       |
| 7                           | `status`           | INTEGER       | 1                 | ❌       | 客户状态：1=跟进中，2=不再回复，3=已约带看，4=已成交未结佣，5=已成交已结佣             | 原有        |
| 8                           | `community`        | TEXT          | ''                | ❌       | 咨询小区名称                                                                           | 原有        |
| 9                           | `business_type`    | TEXT          | 'whole_rent'      | ❌       | 业务类型：whole_rent=整租，centralized=集中，shared_rent=合租                          | 原有        |
| 10                          | `room_type`        | TEXT          | 'one_bedroom'     | ❌       | 居室类型：one_bedroom, two_bedroom, three_bedroom, four_plus, master_room, second_room | 原有        |
| 11                          | `room_tags`        | TEXT          | -                 | ❌       | 房型标签（JSON 数组）：studio, loft, flat, two_bath, bungalow                          | 原有        |
| 12                          | `move_in_date`     | TEXT          | -                 | ❌       | 期望入住时间（YYYY-MM-DD 格式）                                                        | 原有        |
| 13                          | `lease_period`     | INTEGER       | -                 | ❌       | 租赁周期：1-6 月，12 年，24 两年，36 三年+                                             | 原有        |
| 14                          | `price_range`      | TEXT          | -                 | ❌       | 可接受的价格范围（如："5000-7000"）                                                    | 原有        |
| 15                          | `source_channel`   | TEXT          | 'referral'        | ❌       | 来源渠道：xianyu, xiaohongshu, beike, 58tongcheng, shipinhao, douyin, referral         | 原有        |
| **🔗 第三方系统字段**       |
| 16                          | `userId`           | TEXT          | -                 | ❌       | 用户在第三方平台的唯一标识 ID                                                          | **🆕 新增** |
| 17                          | `botId`            | TEXT          | -                 | ❌       | 与用户对话的工作人员/机器人账号 ID                                                     | **🆕 新增** |
| **👤 系统管理字段**         |
| 18                          | `creator`          | TEXT          | '系统'            | ❌       | 录入人姓名                                                                             | 原有        |
| 19                          | `is_agent`         | BOOLEAN       | 1                 | ❌       | 是否为人工录入：1=人工，0=系统                                                         | 原有        |
| 20                          | `internal_notes`   | TEXT          | -                 | ❌       | 内部备注（最多 300 字）                                                                | 原有        |
| **📈 统计字段（计算字段）** |
| 21                          | `total_commission` | DECIMAL(10,2) | 0                 | ❌       | 线索总佣金（自动计算）                                                                 | 原有        |
| 22                          | `viewing_count`    | INTEGER       | 0                 | ❌       | 带看总次数（自动计算）                                                                 | 原有        |
| **⏰ 时间字段**             |
| 23                          | `created_at`       | DATETIME      | CURRENT_TIMESTAMP | ❌       | 创建时间（自动生成）                                                                   | 原有        |
| 24                          | `updated_at`       | DATETIME      | CURRENT_TIMESTAMP | ❌       | 更新时间（自动更新）                                                                   | 原有        |

### 索引信息

```sql
-- 主要索引
CREATE INDEX idx_customers_phone ON customers(phone);
CREATE INDEX idx_customers_status ON customers(status);
CREATE INDEX idx_customers_source_channel ON customers(source_channel);
CREATE INDEX idx_customers_userId ON customers(userId);
CREATE INDEX idx_customers_botId ON customers(botId);
CREATE INDEX idx_customers_created_at ON customers(created_at);
```

---

## 👁️ 2. viewing_records（带看记录表）

**表说明**：存储客户的带看活动记录，包含房源详细信息、第三方系统集成数据和服务链条信息。

### 字段详情（共 34 个字段）

| 序号                    | 字段名                | 数据类型      | 默认值            | 是否必填 | 说明                                                    | 状态        |
| ----------------------- | --------------------- | ------------- | ----------------- | -------- | ------------------------------------------------------- | ----------- |
| **🏷️ 基础信息字段**     |
| 1                       | `id`                  | INTEGER       | -                 | ✅       | 主键，自增 ID                                           | 原有        |
| 2                       | `customer_id`         | INTEGER       | -                 | ❌       | 客户 ID（外键，关联 customers 表）                      | 原有        |
| 3                       | `viewing_time`        | DATETIME      | CURRENT_TIMESTAMP | ❌       | 带看时间                                                | 原有        |
| **🏠 房产信息字段**     |
| 4                       | `property_name`       | TEXT          | '未填写楼盘'      | ❌       | 带看楼盘名称                                            | 原有        |
| 5                       | `property_address`    | TEXT          | -                 | ❌       | 楼盘详细地址                                            | 原有        |
| 6                       | `room_type`           | TEXT          | 'one_bedroom'     | ❌       | 带看户型                                                | 原有        |
| 7                       | `room_tag`            | TEXT          | -                 | ❌       | 房型标签                                                | 原有        |
| **👥 带看服务信息**     |
| 8                       | `viewer_name`         | TEXT          | 'internal'        | ❌       | 带看人类型：internal, external, external_sales, creator | 原有        |
| 9                       | `viewing_status`      | INTEGER       | 1                 | ❌       | 带看状态：1=待确认，2=已确认，3=已取消，4=已带看        | 原有        |
| 10                      | `commission`          | DECIMAL(10,2) | 0                 | ❌       | 本次带看佣金                                            | 原有        |
| 11                      | `viewing_feedback`    | INTEGER       | -                 | ❌       | 带看反馈：0=未成交，1=已成交                            | 原有        |
| 12                      | `business_type`       | TEXT          | 'whole_rent'      | ❌       | 业务类型：whole_rent, centralized, shared_rent          | 原有        |
| 13                      | `notes`               | TEXT          | -                 | ❌       | 带看备注信息                                            | 原有        |
| **📷 客户信息快照字段** |
| 14                      | `customer_name`       | TEXT          | ''                | ❌       | 客户姓名（历史快照，便于查询）                          | **🆕 新增** |
| 15                      | `customer_phone`      | TEXT          | ''                | ❌       | 客户电话（历史快照，便于查询）                          | **🆕 新增** |
| **🔗 第三方系统字段**   |
| 16                      | `userId`              | TEXT          | -                 | ❌       | 用户第三方账号 ID                                       | **🆕 新增** |
| 17                      | `botId`               | TEXT          | -                 | ❌       | 工作人员/机器人账号 ID                                  | **🆕 新增** |
| **🏘️ 房源详细信息字段** |
| 18                      | `housingId`           | INTEGER       | -                 | ❌       | 房源唯一标识 ID                                         | **🆕 新增** |
| 19                      | `houseAreaId`         | INTEGER       | -                 | ❌       | 区域 ID                                                 | **🆕 新增** |
| 20                      | `houseAreaName`       | TEXT          | -                 | ❌       | 区域名称（如：南山区）                                  | **🆕 新增** |
| 21                      | `cityId`              | INTEGER       | -                 | ❌       | 城市 ID                                                 | **🆕 新增** |
| 22                      | `cityName`            | TEXT          | -                 | ❌       | 城市名称（如：深圳市）                                  | **🆕 新增** |
| 23                      | `propertyAddrId`      | INTEGER       | -                 | ❌       | 物业地址 ID                                             | **🆕 新增** |
| 24                      | `unitType`            | TEXT          | -                 | ❌       | 房源户型描述                                            | **🆕 新增** |
| **📍 地理位置字段**     |
| 25                      | `longitude`           | TEXT          | -                 | ❌       | 房源经度坐标                                            | **🆕 新增** |
| 26                      | `latitude`            | TEXT          | -                 | ❌       | 房源纬度坐标                                            | **🆕 新增** |
| **🏠 房间和服务信息**   |
| 27                      | `roomId`              | INTEGER       | -                 | ❌       | 具体房间 ID                                             | **🆕 新增** |
| 28                      | `advisorId`           | INTEGER       | -                 | ❌       | 负责顾问 ID                                             | **🆕 新增** |
| 29                      | `advisorName`         | TEXT          | -                 | ❌       | 负责顾问姓名                                            | **🆕 新增** |
| **🏢 公司信息字段**     |
| 30                      | `companyName`         | TEXT          | -                 | ❌       | 所属公司全名                                            | **🆕 新增** |
| 31                      | `companyAbbreviation` | TEXT          | -                 | ❌       | 公司简称                                                | **🆕 新增** |
| 32                      | `houseTypeId`         | INTEGER       | -                 | ❌       | 房型分类 ID                                             | **🆕 新增** |
| **⏰ 时间字段**         |
| 33                      | `created_at`          | DATETIME      | CURRENT_TIMESTAMP | ❌       | 创建时间（自动生成）                                    | 原有        |
| 34                      | `updated_at`          | DATETIME      | CURRENT_TIMESTAMP | ❌       | 更新时间（自动更新）                                    | 原有        |

### 索引信息

```sql
-- 主要索引
CREATE INDEX idx_viewing_records_customer_id ON viewing_records(customer_id);
CREATE INDEX idx_viewing_records_status ON viewing_records(viewing_status);
CREATE INDEX idx_viewing_records_created_at ON viewing_records(created_at);

-- 建议的扩展索引（根据实际使用情况创建）
-- CREATE INDEX idx_viewing_records_userId ON viewing_records(userId);
-- CREATE INDEX idx_viewing_records_housingId ON viewing_records(housingId);
-- CREATE INDEX idx_viewing_records_cityId ON viewing_records(cityId);
-- CREATE INDEX idx_viewing_records_advisorId ON viewing_records(advisorId);
```

### 外键关系

```sql
-- viewing_records 表的外键约束
FOREIGN KEY (customer_id) REFERENCES customers (id) ON DELETE SET NULL
```

-