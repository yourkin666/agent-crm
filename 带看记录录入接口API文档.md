# å¸¦çœ‹è®°å½•å½•å…¥æ¥å£ API æ–‡æ¡£

## ğŸ“– æ–‡æ¡£ç›®å½•

- [ğŸ“„ æ¥å£æ¦‚è¿°](#-æ¥å£æ¦‚è¿°)
- [ğŸ”„ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘](#-æ ¸å¿ƒä¸šåŠ¡é€»è¾‘)
- [ğŸ“ è¯·æ±‚å‚æ•°](#-è¯·æ±‚å‚æ•°)
- [ğŸ“Š å­—æ®µçŠ¶æ€è¯´æ˜](#-å­—æ®µçŠ¶æ€è¯´æ˜)
- [ğŸ“¤ å“åº”ç»“æœ](#-å“åº”ç»“æœ)
- [ğŸ“‹ ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹](#-ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹)
- [âš ï¸ æ³¨æ„äº‹é¡¹](#ï¸-æ³¨æ„äº‹é¡¹)
- [ğŸ§ª æµ‹è¯•ç¤ºä¾‹](#-æµ‹è¯•ç¤ºä¾‹)
- [â“ å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)
- [ğŸ“Š çŠ¶æ€ç è¯´æ˜](#-çŠ¶æ€ç è¯´æ˜)

---

## ğŸ“„ æ¥å£æ¦‚è¿°

**æ¥å£åç§°**: å¸¦çœ‹è®°å½•å½•å…¥æ¥å£ï¼ˆæ™ºèƒ½å®¢æˆ·å¤„ç† + æˆ¿æºä¿¡æ¯è‡ªåŠ¨æŸ¥è¯¢ + é‡å¤è®°å½•æ™ºèƒ½æ›´æ–°ï¼‰

**æ¥å£åœ°å€**: `POST /api/external/viewing-records`

**åŠŸèƒ½æè¿°**:

- å½•å…¥å¸¦çœ‹è®°å½•æ•°æ®ï¼Œæ™ºèƒ½å¤„ç†å®¢æˆ·ä¿¡æ¯
- è‡ªåŠ¨æŸ¥è¯¢å¤–éƒ¨æˆ¿æºè¯¦ç»†ä¿¡æ¯å¹¶å¡«å……
- æ™ºèƒ½æ£€æŸ¥é‡å¤è®°å½•å¹¶å†³å®šåˆ›å»ºæˆ–æ›´æ–°
- è‡ªåŠ¨æ›´æ–°å®¢æˆ·ç»Ÿè®¡ä¿¡æ¯

**ç‰ˆæœ¬**: v1.0

**æ›´æ–°æ—¥æœŸ**: 2024-08-15

---

## ğŸ”„ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

### 1. å®¢æˆ·å¤„ç†é€»è¾‘

- **æ£€æŸ¥ç”¨æˆ·**: æ ¹æ® `userId` æ£€æŸ¥å®¢æˆ·æ˜¯å¦å·²å­˜åœ¨
- **å­˜åœ¨**: æ›´æ–°å®¢æˆ·ä¿¡æ¯ï¼Œè¿”å› `customer_action: "updated"`
- **ä¸å­˜åœ¨**: åˆ›å»ºæ–°å®¢æˆ·ï¼Œè¿”å› `customer_action: "created"`

### 2. é‡å¤è®°å½•æ£€æŸ¥é€»è¾‘

- **æœ‰è¯¦ç»†åœ°å€**: ä½¿ç”¨ `userId + property_address` ç»„åˆæ£€æŸ¥
- **æ— è¯¦ç»†åœ°å€**: ä½¿ç”¨ `userId + property_name + property_address IS NULL` ç»„åˆæ£€æŸ¥
- **å­˜åœ¨é‡å¤**: æ›´æ–°ç°æœ‰è®°å½•ï¼Œè¿”å› `viewing_record_action: "updated"`
- **ä¸å­˜åœ¨**: åˆ›å»ºæ–°è®°å½•ï¼Œè¿”å› `viewing_record_action: "created"`

### 3. å¤–éƒ¨æˆ¿æºä¿¡æ¯æŸ¥è¯¢

- æ ¹æ® `property_name` å’Œ `property_address` è‡ªåŠ¨æŸ¥è¯¢å¤–éƒ¨æˆ¿æº API
- æˆåŠŸè·å–æˆ¿æºä¿¡æ¯æ—¶è‡ªåŠ¨å¡«å……ç›¸å…³å­—æ®µ
- æŸ¥è¯¢å¤±è´¥ä¸å½±å“å¸¦çœ‹è®°å½•çš„æ­£å¸¸åˆ›å»º

---

## ğŸ“ è¯·æ±‚å‚æ•°

### è¯·æ±‚å¤´

```
Content-Type: application/json
```

### è¯·æ±‚ä½“å‚æ•°

#### åŸºç¡€ä¿¡æ¯å­—æ®µ

| å‚æ•°å           | ç±»å‹   | å¿…å¡« | é»˜è®¤å€¼   | è¯´æ˜                             |
| ---------------- | ------ | ---- | -------- | -------------------------------- |
| `userId`         | string | âœ…   | -        | ç”¨æˆ·ç¬¬ä¸‰æ–¹å”¯ä¸€æ ‡è¯† ID            |
| `botId`          | string | âŒ   | -        | æœºå™¨äºº/å·¥ä½œäººå‘˜è´¦å· ID           |
| `customer_name`  | string | âŒ   | -        | å®¢æˆ·å§“åï¼ˆåŒæ—¶ç”¨ä½œå®¢æˆ·æ˜µç§°ï¼‰     |
| `customer_phone` | string | âŒ   | -        | å®¢æˆ·ç”µè¯ï¼ˆæ ¼å¼ï¼š1[3-9]xxxxxxxxï¼‰ |
| `viewing_time`   | string | âŒ   | å½“å‰æ—¶é—´ | å¸¦çœ‹æ—¶é—´ï¼ˆISO 8601 æ ¼å¼ï¼‰        |

#### æˆ¿æºä¿¡æ¯å­—æ®µ

| å‚æ•°å             | ç±»å‹   | å¿…å¡« | é»˜è®¤å€¼        | è¯´æ˜                                       |
| ------------------ | ------ | ---- | ------------- | ------------------------------------------ |
| `property_name`    | string | âœ…   | -             | ç‰©ä¸šåœ°å€ï¼ˆç”¨äºå¤–éƒ¨æˆ¿æºæŸ¥è¯¢å’Œå®¢æˆ·å’¨è¯¢å°åŒºï¼‰ |
| `property_address` | string | âŒ   | -             | è¯¦ç»†åœ°å€ï¼ˆç”¨äºå¤–éƒ¨æˆ¿æºç²¾ç¡®æŸ¥è¯¢å’Œé‡å¤æ£€æŸ¥ï¼‰ |
| `room_type`        | string | âŒ   | 'one_bedroom' | æˆ¿å‹ç±»å‹                                   |
| `room_tag`         | string | âŒ   | -             | æˆ¿å‹æ ‡ç­¾                                   |

#### å¸¦çœ‹ä¿¡æ¯å­—æ®µ

| å‚æ•°å             | ç±»å‹   | å¿…å¡« | é»˜è®¤å€¼       | è¯´æ˜             |
| ------------------ | ------ | ---- | ------------ | ---------------- |
| `viewer_name`      | string | âŒ   | 'external'   | å¸¦çœ‹äººç±»å‹       |
| `viewing_status`   | number | âŒ   | 1            | å¸¦çœ‹çŠ¶æ€         |
| `commission`       | number | âŒ   | 0            | ä½£é‡‘ï¼ˆå•ä½ï¼šåˆ†ï¼‰ |
| `viewing_feedback` | number | âŒ   | -            | å¸¦çœ‹åé¦ˆ         |
| `business_type`    | string | âŒ   | 'whole_rent' | ä¸šåŠ¡ç±»å‹         |
| `notes`            | string | âŒ   | -            | å¸¦çœ‹å¤‡æ³¨         |

#### æ‰©å±•æˆ¿æºå­—æ®µï¼ˆå¯è¢«å¤–éƒ¨æŸ¥è¯¢è‡ªåŠ¨å¡«å……ï¼‰

| å‚æ•°å                | ç±»å‹   | å¿…å¡« | è¯´æ˜        |
| --------------------- | ------ | ---- | ----------- |
| `housingId`           | number | âŒ   | æˆ¿æº ID     |
| `houseAreaId`         | number | âŒ   | åŒºåŸŸ ID     |
| `houseAreaName`       | string | âŒ   | åŒºåŸŸåç§°    |
| `cityId`              | number | âŒ   | åŸå¸‚ ID     |
| `cityName`            | string | âŒ   | åŸå¸‚åç§°    |
| `propertyAddrId`      | number | âŒ   | ç‰©ä¸šåœ°å€ ID |
| `unitType`            | string | âŒ   | æˆ·å‹æè¿°    |
| `longitude`           | string | âŒ   | ç»åº¦        |
| `latitude`            | string | âŒ   | çº¬åº¦        |
| `roomId`              | number | âŒ   | æˆ¿é—´ ID     |
| `advisorId`           | number | âŒ   | é¡¾é—® ID     |
| `advisorName`         | string | âŒ   | é¡¾é—®å§“å    |
| `companyName`         | string | âŒ   | å…¬å¸åç§°    |
| `companyAbbreviation` | string | âŒ   | å…¬å¸ç®€ç§°    |
| `houseTypeId`         | number | âŒ   | æˆ¿å‹ ID     |

---

## ğŸ“Š å­—æ®µçŠ¶æ€è¯´æ˜

### room_type (æˆ¿å‹ç±»å‹)

| å€¼                  | ä¸­æ–‡åç§°   | è¯´æ˜           |
| ------------------- | ---------- | -------------- |
| `one_bedroom`       | ä¸€å±…å®¤     | å•ç‹¬å§å®¤       |
| `two_bedroom`       | ä¸¤å±…å®¤     | ä¸¤ä¸ªå§å®¤       |
| `three_bedroom`     | ä¸‰å±…å®¤     | ä¸‰ä¸ªå§å®¤       |
| `four_plus_bedroom` | å››å±…åŠä»¥ä¸Š | å››ä¸ªæˆ–æ›´å¤šå§å®¤ |
| `master_room`       | ä¸»å§       | ä¸»å§å®¤         |
| `second_room`       | æ¬¡å§       | æ¬¡å§å®¤         |

### room_tag (æˆ¿å‹æ ‡ç­¾)

| å€¼             | ä¸­æ–‡åç§° | è¯´æ˜       |
| -------------- | -------- | ---------- |
| `studio`       | å¼€é—´     | å¼€æ”¾å¼æˆ¿é—´ |
| `loft`         | Loft     | å¤å¼ç»“æ„   |
| `flat`         | å¹³å±‚     | å¹³å±‚ç»“æ„   |
| `two_bathroom` | ä¸¤å«     | ä¸¤ä¸ªå«ç”Ÿé—´ |
| `bungalow`     | å¹³æˆ¿     | å•å±‚å»ºç­‘   |

### viewer_name (å¸¦çœ‹äººç±»å‹)

| å€¼               | ä¸­æ–‡åç§° | è¯´æ˜             |
| ---------------- | -------- | ---------------- |
| `internal`       | å†…éƒ¨ç®¡å®¶ | å…¬å¸å†…éƒ¨å·¥ä½œäººå‘˜ |
| `external`       | å¤–éƒ¨ç®¡å®¶ | å¤–éƒ¨åˆä½œç®¡å®¶     |
| `external_sales` | å¤–é”€ç®¡å®¶ | å¤–éƒ¨é”€å”®äººå‘˜     |
| `creator`        | å½•å…¥äºº   | æ•°æ®å½•å…¥äººå‘˜     |

### viewing_status (å¸¦çœ‹çŠ¶æ€)

| å€¼  | ä¸­æ–‡åç§° | é¢œè‰² | è¯´æ˜             |
| --- | -------- | ---- | ---------------- |
| `1` | å¾…ç¡®è®¤   | è“è‰² | å·²é¢„çº¦ï¼Œç­‰å¾…ç¡®è®¤ |
| `2` | å·²ç¡®è®¤   | æ©™è‰² | å·²ç¡®è®¤å¸¦çœ‹å®‰æ’   |
| `3` | å·²å–æ¶ˆ   | çº¢è‰² | å¸¦çœ‹å·²å–æ¶ˆ       |
| `4` | å·²å¸¦çœ‹   | ç»¿è‰² | å¸¦çœ‹å·²å®Œæˆ       |

### viewing_feedback (å¸¦çœ‹åé¦ˆ)

| å€¼  | ä¸­æ–‡åç§° | é¢œè‰² | è¯´æ˜         |
| --- | -------- | ---- | ------------ |
| `0` | æœªæˆäº¤   | çº¢è‰² | å¸¦çœ‹åæœªæˆäº¤ |
| `1` | å·²æˆäº¤   | ç»¿è‰² | å¸¦çœ‹åå·²æˆäº¤ |

### business_type (ä¸šåŠ¡ç±»å‹)

| å€¼            | ä¸­æ–‡åç§° | è¯´æ˜         |
| ------------- | -------- | ------------ |
| `whole_rent`  | æ•´ç§Ÿ     | æ•´å¥—æˆ¿å±‹å‡ºç§Ÿ |
| `centralized` | é›†ä¸­å¼   | é›†ä¸­å¼å…¬å¯“   |
| `shared_rent` | åˆç§Ÿ     | åˆç§Ÿæˆ¿å±‹     |

### customer_action (å®¢æˆ·æ“ä½œç±»å‹)

| å€¼        | è¯´æ˜         |
| --------- | ------------ |
| `created` | æ–°åˆ›å»ºå®¢æˆ·   |
| `updated` | æ›´æ–°ç°æœ‰å®¢æˆ· |

### viewing_record_action (å¸¦çœ‹è®°å½•æ“ä½œç±»å‹)

| å€¼        | è¯´æ˜             |
| --------- | ---------------- |
| `created` | æ–°åˆ›å»ºå¸¦çœ‹è®°å½•   |
| `updated` | æ›´æ–°ç°æœ‰å¸¦çœ‹è®°å½• |

---

## ğŸ“¤ å“åº”ç»“æœ

### æˆåŠŸå“åº”æ ¼å¼

```json
{
  "success": true,
  "data": {
    "viewing_record_id": 456,
    "customer_id": 123,
    "customer_action": "created",
    "viewing_record_action": "created",
    "userId": "agent_user_12345",
    "external_property_enriched": true,
    "external_property_data": {
      "propertyAddrId": 12345,
      "housingId": 5678,
      "cityName": "æ·±åœ³å¸‚",
      "houseAreaName": "å—å±±åŒº",
      "advisorId": 2001,
      "advisorName": "ç‹ç»ç†",
      "companyName": "XXæˆ¿äº§å…¬å¸"
    }
  },
  "message": "å¸¦çœ‹è®°å½•å½•å…¥æˆåŠŸï¼Œå®¢æˆ·å·²åˆ›å»ºï¼Œå·²è‡ªåŠ¨å¡«å…¥å¤–éƒ¨æˆ¿æºä¿¡æ¯"
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µ                              | ç±»å‹        | è¯´æ˜                                |
| --------------------------------- | ----------- | ----------------------------------- |
| `success`                         | boolean     | è¯·æ±‚æ˜¯å¦æˆåŠŸ                        |
| `data.viewing_record_id`          | number      | å¸¦çœ‹è®°å½• ID                         |
| `data.customer_id`                | number      | å®¢æˆ· ID                             |
| `data.customer_action`            | string      | å®¢æˆ·æ“ä½œç±»å‹ï¼ˆcreated/updatedï¼‰     |
| `data.viewing_record_action`      | string      | å¸¦çœ‹è®°å½•æ“ä½œç±»å‹ï¼ˆcreated/updatedï¼‰ |
| `data.userId`                     | string      | ç”¨æˆ· ID                             |
| `data.external_property_enriched` | boolean     | æ˜¯å¦æˆåŠŸè·å–å¤–éƒ¨æˆ¿æºä¿¡æ¯            |
| `data.external_property_data`     | object/null | å¤–éƒ¨æˆ¿æºæ•°æ®ï¼ˆæˆåŠŸæ—¶è¿”å›ï¼‰          |
| `message`                         | string      | å“åº”æ¶ˆæ¯                            |

### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "success": false,
  "error": "userIdä¸ºå¿…å¡«å­—æ®µ",
  "message": "è¯·æ±‚æ•°æ®éªŒè¯å¤±è´¥"
}
```

---

## ğŸ“‹ ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1: å…¨æ–°ç”¨æˆ·é¦–æ¬¡å½•å…¥

**è¯·æ±‚**:

```json
{
  "userId": "new_user_001",
  "customer_name": "å¼ ä¸‰",
  "customer_phone": "13800138000",
  "property_name": "é˜³å…‰å°åŒº",
  "property_address": "å—å±±åŒºæ·±å—å¤§é“123å·",
  "room_type": "two_bedroom",
  "viewing_status": 2,
  "commission": 3000
}
```

**å“åº”**:

```json
{
  "success": true,
  "data": {
    "customer_action": "created",
    "viewing_record_action": "created",
    "external_property_enriched": true
  },
  "message": "å¸¦çœ‹è®°å½•å½•å…¥æˆåŠŸï¼Œå®¢æˆ·å·²åˆ›å»ºï¼Œå·²è‡ªåŠ¨å¡«å…¥å¤–éƒ¨æˆ¿æºä¿¡æ¯"
}
```

### åœºæ™¯ 2: ç°æœ‰ç”¨æˆ·æ–°åœ°å€

**è¯·æ±‚**:

```json
{
  "userId": "existing_user_001",
  "property_name": "æ–°çš„å°åŒº",
  "property_address": "æ–°çš„åœ°å€456å·",
  "commission": 4000
}
```

**å“åº”**:

```json
{
  "success": true,
  "data": {
    "customer_action": "updated",
    "viewing_record_action": "created",
    "external_property_enriched": false
  },
  "message": "å¸¦çœ‹è®°å½•å½•å…¥æˆåŠŸï¼Œå®¢æˆ·å·²æ›´æ–°"
}
```

### åœºæ™¯ 3: ç°æœ‰ç”¨æˆ·ç›¸åŒåœ°å€ï¼ˆé‡å¤è®°å½•æ›´æ–°ï¼‰

**è¯·æ±‚**:

```json
{
  "userId": "existing_user_001",
  "property_name": "é˜³å…‰å°åŒº",
  "property_address": "å—å±±åŒºæ·±å—å¤§é“123å·",
  "viewing_status": 4,
  "viewing_feedback": 1,
  "commission": 5000
}
```

**å“åº”**:

```json
{
  "success": true,
  "data": {
    "customer_action": "updated",
    "viewing_record_action": "updated",
    "external_property_enriched": true
  },
  "message": "å¸¦çœ‹è®°å½•æ›´æ–°æˆåŠŸï¼Œå®¢æˆ·å·²æ›´æ–°ï¼Œå·²è‡ªåŠ¨å¡«å…¥å¤–éƒ¨æˆ¿æºä¿¡æ¯"
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ•°æ®éªŒè¯

1. **å¿…å¡«å­—æ®µ**: `userId` å’Œ `property_name` ä¸ºå¿…å¡«å­—æ®µ
2. **æ‰‹æœºå·æ ¼å¼**: æ”¯æŒä¸­å›½å¤§é™†æ‰‹æœºå·æ ¼å¼ `1[3-9]xxxxxxxx`
3. **æ—¶é—´æ ¼å¼**: `viewing_time` æ”¯æŒ ISO 8601 æ ¼å¼
4. **æ•°å€¼èŒƒå›´**: `commission` å»ºè®®ä½¿ç”¨åˆ†ä¸ºå•ä½

### é‡å¤æ£€æŸ¥é€»è¾‘

1. **å®¢æˆ·é‡å¤æ£€æŸ¥**: ä»…åŸºäº `userId` è¿›è¡Œæ£€æŸ¥
2. **å¸¦çœ‹è®°å½•é‡å¤æ£€æŸ¥**: åŸºäº `userId + property_address` ç»„åˆ
3. **æ— è¯¦ç»†åœ°å€æƒ…å†µ**: ä½¿ç”¨ `userId + property_name` ä¸” `property_address IS NULL`

### å¤–éƒ¨æˆ¿æºæŸ¥è¯¢

1. **æŸ¥è¯¢æ¡ä»¶**: éœ€è¦æä¾› `property_name`ï¼Œ`property_address` å¯é€‰
2. **æŸ¥è¯¢å¤±è´¥**: ä¸å½±å“å¸¦çœ‹è®°å½•çš„æ­£å¸¸åˆ›å»º
3. **æ•°æ®ä¼˜å…ˆçº§**: å¤–éƒ¨æŸ¥è¯¢æ•°æ®ä¼˜å…ˆäºæ‰‹åŠ¨ä¼ å…¥æ•°æ®

### é”™è¯¯å¤„ç†

1. **æ•°æ®éªŒè¯å¤±è´¥**: è¿”å› 400 çŠ¶æ€ç å’Œå…·ä½“é”™è¯¯ä¿¡æ¯
2. **æ•°æ®åº“é”™è¯¯**: è¿”å› 500 çŠ¶æ€ç å’Œé€šç”¨é”™è¯¯ä¿¡æ¯
3. **å¤–éƒ¨ API é”™è¯¯**: è®°å½•æ—¥å¿—ä½†ä¸å½±å“ä¸»æµç¨‹

---

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### cURL æµ‹è¯•å‘½ä»¤

```bash
# åŸºç¡€æµ‹è¯• - åˆ›å»ºæ–°ç”¨æˆ·å’Œå¸¦çœ‹è®°å½•
curl -X POST http://localhost:3000/api/external/viewing-records \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "test_user_001",
    "customer_name": "æµ‹è¯•ç”¨æˆ·",
    "customer_phone": "13800138000",
    "property_name": "æµ‹è¯•å°åŒº",
    "property_address": "æµ‹è¯•åœ°å€123å·",
    "room_type": "two_bedroom",
    "viewing_status": 2,
    "commission": 3000,
    "notes": "æµ‹è¯•åˆ›å»ºæ–°è®°å½•"
  }'

# é‡å¤æµ‹è¯• - æ›´æ–°ç°æœ‰è®°å½•
curl -X POST http://localhost:3000/api/external/viewing-records \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "test_user_001",
    "property_name": "æµ‹è¯•å°åŒº",
    "property_address": "æµ‹è¯•åœ°å€123å·",
    "viewing_status": 4,
    "viewing_feedback": 1,
    "commission": 5000,
    "notes": "æµ‹è¯•æ›´æ–°ç°æœ‰è®°å½•"
  }'
```

### JavaScript æµ‹è¯•ä»£ç 

```javascript
// æµ‹è¯•å‡½æ•°
async function testViewingRecordAPI() {
  const baseUrl = 'http://localhost:3000';
  
  // æµ‹è¯•æ•°æ®
  const testData = {
    userId: 'js_test_user_001',
    customer_name: 'å¼ ä¸‰',
    customer_phone: '13900139000',
    property_name: 'é˜³å…‰èŠ±å›­',
    property_address: 'å—å±±åŒºæ·±å—å¤§é“999å·',
    room_type: 'two_bedroom',
    viewing_status: 2,
    commission: 4000,
    business_type: 'whole_rent',
    notes: 'JavaScriptæµ‹è¯•'
  };
  
  try {
    const response = await fetch(`${baseUrl}/api/external/viewing-records`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(testData)
    });
    
    const result = await response.json();
    console.log('å“åº”çŠ¶æ€:', response.status);
    console.log('å“åº”ç»“æœ:', result);
    
    return result;
  } catch (error) {
    console.error('è¯·æ±‚å¤±è´¥:', error);
  }
}

// è¿è¡Œæµ‹è¯•
testViewingRecordAPI();
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•å¤„ç†é‡å¤çš„å¸¦çœ‹è®°å½•ï¼Ÿ

**A**: ç³»ç»Ÿä¼šæ ¹æ® `userId + property_address` ç»„åˆè‡ªåŠ¨æ£€æŸ¥é‡å¤è®°å½•ï¼š
- å¦‚æœå‘ç°é‡å¤ï¼Œä¼šæ›´æ–°ç°æœ‰è®°å½•è€Œä¸æ˜¯åˆ›å»ºæ–°è®°å½•
- å“åº”ä¸­çš„ `viewing_record_action` å­—æ®µä¼šæ˜¾ç¤º `"updated"`
- å¦‚æœæ²¡æœ‰ `property_address`ï¼Œä¼šä½¿ç”¨ `userId + property_name` ç»„åˆæ£€æŸ¥

### Q2: å¤–éƒ¨æˆ¿æºæŸ¥è¯¢å¤±è´¥ä¼šå½±å“å½•å…¥å—ï¼Ÿ

**A**: ä¸ä¼šå½±å“ã€‚å¤–éƒ¨æˆ¿æºæŸ¥è¯¢å¤±è´¥æ—¶ï¼š
- å¸¦çœ‹è®°å½•ä»ä¼šæ­£å¸¸åˆ›å»º/æ›´æ–°
- `external_property_enriched` å­—æ®µä¼šè¿”å› `false`
- `external_property_data` å­—æ®µä¼šè¿”å› `null`
- æ‰‹åŠ¨ä¼ å…¥çš„æˆ¿æºå­—æ®µä»ä¼šè¢«ä¿å­˜

### Q3: å¦‚ä½•åˆ¤æ–­å®¢æˆ·æ˜¯æ–°åˆ›å»ºè¿˜æ˜¯æ›´æ–°çš„ï¼Ÿ

**A**: é€šè¿‡å“åº”ä¸­çš„ `customer_action` å­—æ®µï¼š
- `"created"`: è¡¨ç¤ºæ–°åˆ›å»ºäº†å®¢æˆ·
- `"updated"`: è¡¨ç¤ºæ›´æ–°äº†ç°æœ‰å®¢æˆ·

### Q4: ä½£é‡‘å­—æ®µåº”è¯¥ä½¿ç”¨ä»€ä¹ˆå•ä½ï¼Ÿ

**A**: å»ºè®®ä½¿ç”¨**åˆ†**ä¸ºå•ä½ï¼Œä¾‹å¦‚ï¼š
- 30å…ƒ = 3000åˆ†
- 150å…ƒ = 15000åˆ†
- è¿™æ ·å¯ä»¥é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜

### Q5: viewing_time å­—æ®µæ”¯æŒå“ªäº›æ—¶é—´æ ¼å¼ï¼Ÿ

**A**: æ”¯æŒ ISO 8601 æ ¼å¼ï¼Œä¾‹å¦‚ï¼š
- `"2024-08-15T14:30:00.000Z"` (UTCæ—¶é—´)
- `"2024-08-15T14:30:00+08:00"` (å¸¦æ—¶åŒº)
- å¦‚æœä¸æä¾›ï¼Œç³»ç»Ÿä¼šä½¿ç”¨å½“å‰æ—¶é—´

### Q6: æ‰‹æœºå·æ ¼å¼æœ‰ä»€ä¹ˆè¦æ±‚ï¼Ÿ

**A**: æ”¯æŒä¸­å›½å¤§é™†æ‰‹æœºå·ï¼š
- æ ¼å¼ï¼š`1[3-9]xxxxxxxx`
- ä¾‹å¦‚ï¼š`13800138000`ã€`15900159000`
- ä¸æ”¯æŒï¼šåº§æœºå·ã€å›½å¤–æ‰‹æœºå·

### Q7: å¦‚ä½•å¤„ç†æ•°æ®éªŒè¯é”™è¯¯ï¼Ÿ

**A**: ç³»ç»Ÿä¼šè¿”å›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š
```json
{
  "success": false,
  "error": "å…·ä½“é”™è¯¯æè¿°",
  "message": "è¯·æ±‚æ•°æ®éªŒè¯å¤±è´¥"
}
```
å¸¸è§éªŒè¯é”™è¯¯ï¼š
- `userIdä¸ºå¿…å¡«å­—æ®µ`
- `property_nameä¸ºå¿…å¡«å­—æ®µ`
- `æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®`

---

## ğŸ“Š çŠ¶æ€ç è¯´æ˜

| HTTPçŠ¶æ€ç  | è¯´æ˜ | ç¤ºä¾‹åœºæ™¯ |
|-----------|------|---------|
| `200` | æˆåŠŸ | æ­£å¸¸å½•å…¥/æ›´æ–° |
| `201` | åˆ›å»ºæˆåŠŸ | æ–°å»ºå¸¦çœ‹è®°å½• |
| `400` | è¯·æ±‚é”™è¯¯ | å‚æ•°éªŒè¯å¤±è´¥ |
| `500` | æœåŠ¡å™¨é”™è¯¯ | æ•°æ®åº“è¿æ¥å¤±è´¥ |

---

## ğŸ”— ç›¸å…³æ¥å£

- [å®¢æˆ·ç®¡ç†æ¥å£](./å®¢æˆ·ç®¡ç†æ¥å£æ–‡æ¡£.md)
- [å¸¦çœ‹è®°å½•æŸ¥è¯¢æ¥å£](./å¸¦çœ‹è®°å½•æŸ¥è¯¢æ¥å£æ–‡æ¡£.md)
- [å¤–éƒ¨æˆ¿æºæŸ¥è¯¢æ¥å£](./å¤–éƒ¨æˆ¿æºæŸ¥è¯¢æ¥å£æ–‡æ¡£.md)

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0 (2024-08-15)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… æ”¯æŒæ™ºèƒ½å®¢æˆ·å¤„ç†
- âœ… æ”¯æŒå¤–éƒ¨æˆ¿æºä¿¡æ¯è‡ªåŠ¨æŸ¥è¯¢
- âœ… æ”¯æŒé‡å¤è®°å½•æ™ºèƒ½æ£€æŸ¥å’Œæ›´æ–°
- âœ… å®Œæ•´çš„å­—æ®µçŠ¶æ€è¯´æ˜
- âœ… è¯¦ç»†çš„ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿã€‚

**æ¥å£è´Ÿè´£äºº**: CRMç³»ç»Ÿå¼€å‘å›¢é˜Ÿ  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-08-15  
**ä¸‹æ¬¡æ›´æ–°**: æ ¹æ®éœ€æ±‚å˜æ›´
